<script src="/socket.io/socket.io.js"></script>

<script>
  var socket = io('{{{socketConnectURL}}}');
</script>

<script>
  var studentElmMapping = {};
  socket.on('state', function(payload) {
    payload = JSON.parse(payload);
    console.log(payload)
    if (payload.data.totals) {
      document.getElementById('count').firstChild.data = payload.data.totals;
    }
    document.getElementById("stars").className = "bounce";
    setTimeout(function(){document.getElementById("stars").className = "";}, 800);

    if (payload.data.students) {
      var ul = document.getElementById('students');
      for (var i = 0; i < payload.data.students.length; i++) {
        if (!studentElmMapping[payload.data.students[i].name]) {
          var li = ul.appendChild(document.createElement('li'));
          li.appendChild(document.createTextNode(payload.data.students[i].name));
          studentElmMapping[payload.data.students[i].name] = li;
        }
      }
    }
  });
</script>


<div>
  <form method="post" action="/api/quit" class="header">
    <button type="submit" style="float: right;" title="Logg ut">x</button>
    <div id="stars">
      <h1>
          <span class="first">‚≠ê</span>
          <span class="second">üåü</span>
          <span class="third">{{className}}</span>
          <span class="fourth">üåü</span>
          <span class="third">‚≠ê</span>
        </div>
        <div class="class-code-label">Klassekode: <b>{{classId}}</b></div>
      </h1>
    </div>
    <h2>fra {{school}}</h2>
  </form>
 
{{#if bingo}}
<h3>Bingo!</h3>
<div class="instruksjon">
  <span id="geodesc"></span>
  <br /><button type="submit" class="default-btn positive-btn" id="nextbingo">‚úî</button>
</div>
<script src="/js/shared.js"></script>
<script src="/js/raphael.js"></script>
<script>
  var shapeTypes = {{{shapeTypes}}};
  var keys = Object.keys(shapeTypes);
  document.getElementById('nextbingo').onclick = function() {
    document.getElementById('geodesc').innerHTML = '‚åõ';
    setTimeout(function(){
      var item = getRandomWholeNumber(0, keys.length - 1);
      document.getElementById('geodesc').innerHTML = 'Finn <b>' + shapeTypes[keys[item]] + '</b>';
      socket.emit('new-bingo-answer', {answer: keys[item], classId: {{classId}} });
    }, 400);
  }

  socket.on('bingo-card-update', function(data) {
    console.log(data);
    var name = data.name;
    if (studentElmMapping[name]) {
      var elm = studentElmMapping[name];
      var div = elm.getElementsByTagName('div')[0];
      if (!div) {
        div = elm.appendChild(document.createElement('div'));
        div.className = 'mini-bingo-board';
      }
      div.innerHTML = '';
      createAndFillGrid(div, data.cards);
    }
  });

  socket.on('bingo', function(data) {
    alert('Bingo! ' + data.name );
  });

</script>

{{/if}}
  <div class="col1">
  <div id="count">0</div> 
  <p>svar!</p>
  <div id="timer">0:00 <br>
    <button id="startClock">Start klokke</button>
    <button id="resetClock">Tilbakestill klokke</button>
    <script type="text/javascript">
  var sessionType = '{{sessionType}}';
  (function() {
    var seconds = 0;
    var interval;
    var running = false;

    function resetClock() {
      seconds = 0;
      updateUI();
    };

    function incrementClock() {
      seconds++;
      updateUI();
    }

    function updateUI() {
      var hours = Math.floor(seconds / 3600);
      var minutes = Math.floor((seconds - hours * 3600) / 60);
      var secs = Math.floor(seconds - hours * 3600 - minutes * 60);
      document.getElementById("timer").firstChild.data =
        "" +
        (hours ? hours + ":" : "") +
        (hours ? String(100 + minutes).substr(-2) : minutes) +
        ":" +
        String(100 + secs).substr(-2);
    }

     function toggleClock(evt) {
      if (running) {
        running = false;
        clearInterval(interval);
        evt.target.firstChild.data = "Start klokke";
      } else {
        running = true;
        interval = setInterval(incrementClock, 1000);
        evt.target.firstChild.data = "Stopp klokke";
      }
    };
    document.getElementById('startClock').onclick = toggleClock;
    document.getElementById('resetClock').onclick = resetClock;
  })();
    </script>
  </div>
  </div>
  <div class="col2">
  <p class="instruksjon">
    <h2>Elever:</h2>
    <ul id="students"></ul>
  </p>
</div>
</div>
